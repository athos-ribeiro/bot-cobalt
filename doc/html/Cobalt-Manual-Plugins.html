<html><head><title>Cobalt::Manual::Plugins</title>
			<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="http://search.cpan.org/s/style.css">
			<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
			<h1>Cobalt2 POD (Cobalt/Manual/Plugins.pod)</h1>
			<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="http://search.cpan.org/s/style.css">

</head>
			<body class="pod">
                                 <a name='___top' class='dummyTopAnchor' ></a>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#PLUGIN_FUNDAMENTALS'>PLUGIN FUNDAMENTALS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Module_paths_and_configuration'>Module paths and configuration</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#plugins.conf'>plugins.conf</a>
      <li class='indexItem indexItem3'><a href='#Accessing_plugin_configuration'>Accessing plugin configuration</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#A_basic_plugin_outline'>A basic plugin outline</a>
    <li class='indexItem indexItem2'><a href='#Handling_events'>Handling events</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Registering_for_events'>Registering for events</a>
      <li class='indexItem indexItem3'><a href='#Event_handlers'>Event handlers</a>
      <li class='indexItem indexItem3'><a href='#Returning_proper_values'>Returning proper values</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#PLUGIN_EAT_NONE'>PLUGIN_EAT_NONE</a>
        <li class='indexItem indexItem4'><a href='#PLUGIN_EAT_ALL'>PLUGIN_EAT_ALL</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#Receiving_IRC_events'>Receiving IRC events</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Understanding_server_context'>Understanding server context</a>
      <li class='indexItem indexItem3'><a href='#Messages'>Messages</a>
      <li class='indexItem indexItem3'><a href='#Commands'>Commands</a>
      <li class='indexItem indexItem3'><a href='#Other_events'>Other events</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Sending_IRC_events'>Sending IRC events</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Sending_messages'>Sending messages</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#send_message'>send_message</a>
        <li class='indexItem indexItem4'><a href='#send_notice'>send_notice</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Channel-related_commands'>Channel-related commands</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#join'>join</a>
        <li class='indexItem indexItem4'><a href='#part'>part</a>
        <li class='indexItem indexItem4'><a href='#kick'>kick</a>
        <li class='indexItem indexItem4'><a href='#mode'>mode</a>
        <li class='indexItem indexItem4'><a href='#topic'>topic</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Accessing_the_IRC_component_directly'>Accessing the IRC component directly</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Obtaining_the_IRC_component'>Obtaining the IRC component</a>
        <li class='indexItem indexItem4'><a href='#Frequently_useful_PoCo%3A%3AIRC_commands'>Frequently useful PoCo::IRC commands</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#Core_methods'>Core methods</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Accessors'>Accessors</a>
      <li class='indexItem indexItem3'><a href='#Timer_management'>Timer management</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#timer_set'>timer_set</a>
        <li class='indexItem indexItem4'><a href='#timer_del'>timer_del</a>
        <li class='indexItem indexItem4'><a href='#timer_del_pkg'>timer_del_pkg</a>
      </ul>
    </ul>
    <li class='indexItem indexItem2'><a href='#Syndicated_core_events'>Syndicated core events</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Plugin-related'>Plugin-related</a>
      <li class='indexItem indexItem3'><a href='#Langset-related'>Langset-related</a>
      <li class='indexItem indexItem3'><a href='#Timer-related'>Timer-related</a>
      <li class='indexItem indexItem3'><a href='#Auth_module'>Auth module</a>
    </ul>
  </ul>
  <li class='indexItem indexItem1'><a href='#PLUGIN_DESIGN_TIPS'>PLUGIN DESIGN TIPS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Keeping_track_of_%24core'>Keeping track of $core</a>
    <li class='indexItem indexItem2'><a href='#Using_Moose'>Using Moose</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#ADVANCED_CONCEPTS'>ADVANCED CONCEPTS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Breaking_up_lengthy_loops'>Breaking up lengthy loops</a>
    <li class='indexItem indexItem2'><a href='#Custom_per-plugin_language_sets'>Custom per-plugin language sets</a>
    <li class='indexItem indexItem2'><a href='#Spawning_your_own_POE%3A%3ASession'>Spawning your own POE::Session</a>
    <li class='indexItem indexItem2'><a href='#Manipulating_plugin_pipeline_order'>Manipulating plugin pipeline order</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#IRC_CAVEATS'>IRC CAVEATS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#IRC_casemapping_rules'>IRC casemapping rules</a>
    <li class='indexItem indexItem2'><a href='#Character_encodings'>Character encodings</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Relevant_modules'>Relevant modules</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Cobalt::Manual::Plugins - Plugin-writing fundamentals guide</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>Plugins guide revision: 0001</p>

<p>Last updated for cobalt 2.00</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This POD attempts to be a reasonably complete guide to writing useful <b>Cobalt2</b> plugins.</p>

<p>Refer to <a href="#SEE_ALSO" class="podlinkpod"
>&#34;SEE ALSO&#34;</a> for other relevant documentation.</p>

<p><b>Plugin authors should at least read the Cobalt::IRC POD!</b></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PLUGIN_FUNDAMENTALS"
>PLUGIN FUNDAMENTALS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Module_paths_and_configuration"
>Module paths and configuration</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="plugins.conf"
>plugins.conf</a></h3>

<p>Plugins specified in plugins.conf (located in our etc/) will be automatically loaded at runtime.</p>

<p><code>plugins.conf</code> is YAML in the following structure:</p>

<pre>  ---
  MyPlugin:
    Module: Cobalt::Plugin::User::MyPlugin
    Config: plugins/mine/myplugin.conf</pre>

<p>Configuration files specified in &#39;Config: &#39; are expected to be valid YAML. They&#39;ll be automatically loaded at load-time; the data structure loaded will be stored in the core &#39;cfg&#39; attribute. See below.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Accessing_plugin_configuration"
>Accessing plugin configuration</a></h3>

<p>FIXME need core get_plugin_cfg</p>

<p>FIXME discussion about direct access</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="A_basic_plugin_outline"
>A basic plugin outline</a></h2>

<pre>  package Cobalt::Plugin::User::MyPlugin;
  our $VERSION = &#39;0.001&#39;;
  use strict;
  use warnings;
  
  ## You need Object::Pluggable::Constants in order to return valid
  ## pipeline control values, else you might break some or all plugins.
  ##
  ## See &#34;Returning proper values&#34; under &#34;Handling events&#34; in this POD.
  ## 
  ## PLUGIN_EAT_NONE is the most common.
  ##
  ## importing :ALL will give you all of them:
  use Object::Pluggable::Constants qw/ :ALL /;
  
  ## Cobalt::Utils provides many useful methods:
  use Cobalt::Utils qw/ :ALL /;
  
  ## minimalist object constructor:
  sub new { bless( {}, shift ) }
  
  ## called when we are loaded:
  sub Cobalt_register {
    ## handlers receive $self and $core as first two args:
    ## $self is &#34;this object&#34;
    ## $core gives us access to core attributes and methods:
    my ($self, $core) = @_;
    
    ## register to only receive public msg events:
    $core-&#62;plugin_register( $self, &#39;SERVER&#39;,
      [ &#39;public_msg&#39; ]
    );
    
    ## log that we&#39;re here now:
    $core-&#62;log-&#62;info(&#34;Registered&#34;);
    
    ## ALWAYS return an Object::Pluggable::Constants value:
    return PLUGIN_EAT_NONE
  }
  
  ## called when we are unloaded:
  sub Cobalt_unregister {
    my ($self, $core) = @_;
    $core-&#62;log-&#62;info(&#34;Unregistering; bye!&#34;);
    return PLUGIN_EAT_NONE
  }
  
  ## Syndicated events become prefixed with &#39;Bot_&#39;
  ## (when called send_event, leave the prefix out)
  sub Bot_public_msg {
    my ($self, $core) = @_;
    ...
  }
  
  1;  ## perl modules must end in &#39;1;&#39;</pre>

<p>Also see the <a href="http://search.cpan.org/perldoc?Cobalt%3A%3AManual%3A%3AExamples" class="podlinkpod"
>Cobalt::Manual::Examples</a> POD</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Handling_events"
>Handling events</a></h2>

<p>Plugins are fundamentally event driven.</p>

<p>A plugin will (usually at load-time) register to receive some set of events, which are pushed through the pipeline by the Cobalt core (with help from <a href="http://search.cpan.org/perldoc?POE%3A%3AComponent%3A%3ASyndicator" class="podlinkpod"
>POE::Component::Syndicator</a> and <a href="http://search.cpan.org/perldoc?Object%3A%3APluggable" class="podlinkpod"
>Object::Pluggable</a>).</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Registering_for_events"
>Registering for events</a></h3>

<p>Registering for events typically happens at plugin load-time; in other words, inside <code>Cobalt_register</code>:</p>

<pre>  my ($self, $core) = @_;
  
  $core-&#62;plugin_register( $self, &#39;SERVER&#39;,
    [ &#39;chan_sync&#39; ],
    [ &#39;public_msg&#39; ],
  );
  
  ## or to receive all events:
  $core-&#62;plugin_register( $self, &#39;SERVER&#39;,
    [ &#39;all&#39; ],
  );</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Event_handlers"
>Event handlers</a></h3>

<p>Syndicated events become prefixed with Bot_ when handed off to plugins:</p>

<pre>  sub Bot_some_event {
    my ($self, $core) = splice @_, 0, 2;
    my $deref_first_arg = $$_[0];
    ...
  }</pre>

<p><b>IMPORTANT: the arguments passed to event handlers are ALWAYS references!</b></p>

<p>(If you don&#39;t know what that means, it&#39;s time to read <a href="http://search.cpan.org/perldoc?perlreftut" class="podlinkpod"
>perlreftut</a> and <a href="http://search.cpan.org/perldoc?perlref" class="podlinkpod"
>perlref</a> immediately.)</p>

<p>This means that it&#39;s intended behavior to be able to modify the event&#39;s arguments before it continues through the plugin pipeline.</p>

<p><b>That might not be what you want.</b></p>

<p>Be aware of this behavior and code appropriately.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Returning_proper_values"
>Returning proper values</a></h3>

<p>The plugin system is a pipeline.</p>

<p>Unless manipulated manually, Cobalt&#39;s pipeline starts with the core (&#39;Main&#39; context) IRC plugin provided by <a href="http://search.cpan.org/perldoc?Cobalt%3A%3AIRC" class="podlinkpod"
>Cobalt::IRC</a>. The remaining plugins are loaded in the order they&#39;re specified in.</p>

<p>That being the case, events will be handed on down the pipeline, <b>unless</b> a handler for a syndicated event returns an incorrect value.</p>

<p>Your Bot_* event handlers should <b>always</b> return an <a href="http://search.cpan.org/perldoc?Object%3A%3APluggable%3A%3AConstants" class="podlinkpod"
>Object::Pluggable::Constants</a> value. The two commonly used values are:</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="PLUGIN_EAT_NONE"
>PLUGIN_EAT_NONE</a></h4>

<p>Allow the event to continue to pass through the pipeline.</p>

<p><b>This is the most common return value for event handlers.</b></p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="PLUGIN_EAT_ALL"
>PLUGIN_EAT_ALL</a></h4>

<p>Eat the event, removing it from the plugin pipeline.</p>

<p>Typically you might return *_EAT_ALL on self-syndicated events.</p>

<p>For example, a plugin that breaks up a loop into chunks without its own POE session might self-syndicate some kind of loop event, eating the event when the loop is complete (also see <a href="#ADVANCED_CONCEPTS" class="podlinkpod"
>&#34;ADVANCED CONCEPTS&#34;</a>).</p>

<p>This can also be useful when there is a good reason to terminate an event&#39;s lifetime; for example, implementing a plugin that loads itself at the front of the pipeline and restricts outgoing events based on some criteria.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Receiving_IRC_events"
>Receiving IRC events</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Understanding_server_context"
>Understanding server context</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Messages"
>Messages</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Commands"
>Commands</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Other_events"
>Other events</a></h3>

<p>All of the typical instances of &#34;stuff going on&#34; on IRC are reported by the core IRC module in context &#34;Main&#34;</p>

<p><b> The documentation for all events parsed and re-broadcast from IRC is available via the Cobalt::IRC POD </b></p>

<p>See (FIXME - link) or <i>perldoc lib::Cobalt::IRC</i> from the cobalt2 distribution&#39;s directory.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Sending_IRC_events"
>Sending IRC events</a></h2>

<p><a href="http://search.cpan.org/perldoc?Cobalt%3A%3AIRC" class="podlinkpod"
>Cobalt::IRC</a> receives the following commonly-used events:</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Sending_messages"
>Sending messages</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="send_message"
>send_message</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="send_notice"
>send_notice</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Channel-related_commands"
>Channel-related commands</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="join"
>join</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="part"
>part</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="kick"
>kick</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="mode"
>mode</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="topic"
>topic</a></h4>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Accessing_the_IRC_component_directly"
>Accessing the IRC component directly</a></h3>

<p>The IRC backend for the core distribution is <a href="http://search.cpan.org/perldoc?POE%3A%3AComponent%3A%3AIRC" class="podlinkpod"
>POE::Component::IRC</a>, more specifically the <code>State</code> subclass.</p>

<p><a href="http://search.cpan.org/perldoc?POE%3A%3AComponent%3A%3AIRC" class="podlinkpod"
>POE::Component::IRC</a> is a very mature and complete IRC framework.</p>

<p>If your plugin does any kind of IRC-related heavy lifting, you will almost certainly want to consult the documentation for <a href="http://search.cpan.org/perldoc?POE%3A%3AComponent%3A%3AIRC" class="podlinkpod"
>POE::Component::IRC</a> and <a href="http://search.cpan.org/perldoc?POE%3A%3AComponent%3A%3AIRC%3A%3AState" class="podlinkpod"
>POE::Component::IRC::State</a>.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Obtaining_the_IRC_component"
>Obtaining the IRC component</a></h4>

<p>You can retrieve the IRC component object for direct access via the core&#39;s get_irc_obj method. Expects a server context:</p>

<pre>  sub Bot_public_msg {
    my ($self, $core) = @_;
    my $context = $$_[0];
    my $irc = $core-&#62;get_irc_obj($context);
  }</pre>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Frequently_useful_PoCo::IRC_commands"
>Frequently useful PoCo::IRC commands</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Core_methods"
>Core methods</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Accessors"
>Accessors</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Timer_management"
>Timer management</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="timer_set"
>timer_set</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="timer_del"
>timer_del</a></h4>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="timer_del_pkg"
>timer_del_pkg</a></h4>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Syndicated_core_events"
>Syndicated core events</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Plugin-related"
>Plugin-related</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Langset-related"
>Langset-related</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Timer-related"
>Timer-related</a></h3>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Auth_module"
>Auth module</a></h3>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PLUGIN_DESIGN_TIPS"
>PLUGIN DESIGN TIPS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Keeping_track_of_$core"
>Keeping track of $core</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Using_Moose"
>Using Moose</a></h2>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="ADVANCED_CONCEPTS"
>ADVANCED CONCEPTS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Breaking_up_lengthy_loops"
>Breaking up lengthy loops</a></h2>

<p>FIXME discussion of pushing self-events back to pipeline to loop</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Custom_per-plugin_language_sets"
>Custom per-plugin language sets</a></h2>

<p>FIXME discussion of using load_langset to create a &#39;local&#39; RPL hash</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Spawning_your_own_POE::Session"
>Spawning your own POE::Session</a></h2>

<p>FIXME discussion of plugins that initiate their own sessions</p>

<p>FIXME registering for events from irc...?</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Manipulating_plugin_pipeline_order"
>Manipulating plugin pipeline order</a></h2>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="IRC_CAVEATS"
>IRC CAVEATS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="IRC_casemapping_rules"
>IRC casemapping rules</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Character_encodings"
>Character encodings</a></h2>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p>Plugin authors should at least read the <a href="http://search.cpan.org/perldoc?Cobalt%3A%3AIRC" class="podlinkpod"
>Cobalt::IRC</a> POD, and probably <a href="http://search.cpan.org/perldoc?Cobalt%3A%3AUtils" class="podlinkpod"
>Cobalt::Utils</a> as well.</p>

<p>FIXME links etc</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Relevant_modules"
>Relevant modules</a></h2>

<ul>
<li><a href="http://search.cpan.org/perldoc?POE%3A%3AComponent%3A%3ASyndicator" class="podlinkpod"
>POE::Component::Syndicator</a></li>

<li><a href="http://search.cpan.org/perldoc?POE%3A%3AComponent%3A%3AIRC" class="podlinkpod"
>POE::Component::IRC</a></li>

<li><a href="http://search.cpan.org/perldoc?POE%3A%3AComponent%3A%3AIRC%3A%3AState" class="podlinkpod"
>POE::Component::IRC::State</a></li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Jon Portnoy &#60;avenj@cobaltirc.org&#62;</p>

<p>http://www.cobaltirc.org</p>

<!-- end doc -->

</body></html>
